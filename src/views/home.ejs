<% layout('_layout', { title: 'Search' }) %>
<h1 class="mb-3 text-2xl font-semibold">Search</h1>
<form id="f" class="flex flex-col gap-2 sm:flex-row">
  <input class="flex-1 rounded-lg border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500" name="q" placeholder="Search across your PDFs…" />
  <button class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500">Go</button>
</form>
<div id="r" class="mt-4 space-y-3"></div>
<script>
  const f = document.getElementById('f'), r = document.getElementById('r');
  f.addEventListener('submit', async (e) => {
    e.preventDefault();
    const q = new FormData(f).get('q') || '';
    const res = await fetch('/api/search?q=' + encodeURIComponent(q));
    const { results } = await res.json();
    r.innerHTML = results.map(x => `
      <div class="rounded-xl border p-3">
        <div class="text-sm text-gray-500">${x.title} — page ${x.page_number}</div>
        <div class="mt-1">${x.snippet}</div>
      </div>`).join('');
  });
</script>
